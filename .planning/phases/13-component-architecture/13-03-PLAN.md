---
phase: 13-component-architecture
plan: 03
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - frontend/src/components/forms/FactoryForm.tsx
  - frontend/src/components/forms/GatewayForm.tsx
autonomous: true

must_haves:
  truths:
    - "FactoryForm renders name, location, and timezone fields with labels"
    - "GatewayForm renders factory select, gateway ID, name, URL, email, password, model, and firmware fields"
    - "Both forms validate required fields using Zod schemas and show error messages"
    - "Both forms accept onSubmit callback and optional defaultValues for edit mode"
    - "Forms use shadcn Input and Label components with consistent styling"
    - "Password field in GatewayForm uses type='password' for masking"
  artifacts:
    - path: "frontend/src/components/forms/FactoryForm.tsx"
      provides: "Reusable factory create/edit form with Zod validation"
      exports: ["FactoryForm", "factoryFormSchema"]
    - path: "frontend/src/components/forms/GatewayForm.tsx"
      provides: "Reusable gateway create/edit form with Zod validation"
      exports: ["GatewayForm", "gatewayFormSchema"]
  key_links:
    - from: "frontend/src/components/forms/FactoryForm.tsx"
      to: "@/components/ui/input"
      via: "Input component import"
      pattern: "import.*Input.*from.*@/components/ui/input"
    - from: "frontend/src/components/forms/FactoryForm.tsx"
      to: "react-hook-form"
      via: "useForm hook with zodResolver"
      pattern: "useForm.*zodResolver"
    - from: "frontend/src/components/forms/GatewayForm.tsx"
      to: "react-hook-form"
      via: "useForm hook with zodResolver"
      pattern: "useForm.*zodResolver"
---

<objective>
Create reusable form components for factory and gateway management with Zod validation.

Purpose: Establish the form component architecture (COMP-02) with React Hook Form + Zod integration patterns that Phases 15 and 16 will consume directly. Forms are designed for reuse in both create and edit modes.

Output: Two form components (`FactoryForm`, `GatewayForm`) in `frontend/src/components/forms/` with Zod schemas, React Hook Form integration, and consistent error display patterns.
</objective>

<execution_context>
@/Users/craigcronin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/craigcronin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-component-architecture/13-RESEARCH.md
@frontend/src/types/api.ts
@frontend/src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FactoryForm component with Zod validation</name>
  <files>frontend/src/components/forms/FactoryForm.tsx</files>
  <action>
    Create `frontend/src/components/forms/` directory and the FactoryForm component.

    **FactoryForm.tsx:**

    Imports:
    - `useForm` from `react-hook-form`
    - `zodResolver` from `@hookform/resolvers/zod`
    - `z` from `zod`
    - `Button` from `@/components/ui/button`
    - `Input` from `@/components/ui/input`
    - `Label` from `@/components/ui/label`

    **Zod schema (export as `factoryFormSchema`):**
    ```typescript
    export const factoryFormSchema = z.object({
      name: z.string().min(1, 'Factory name is required').max(100, 'Name must be 100 characters or less'),
      location: z.string().max(200, 'Location must be 200 characters or less').optional().or(z.literal('')),
      timezone: z.string().min(1, 'Timezone is required'),
    })
    ```
    Type: `export type FactoryFormData = z.infer<typeof factoryFormSchema>`

    **Component props interface:**
    ```typescript
    interface FactoryFormProps {
      defaultValues?: Partial<FactoryFormData>
      onSubmit: (data: FactoryFormData) => Promise<void>
      isSubmitting?: boolean
      submitLabel?: string  // "Create Factory" or "Save Changes"
    }
    ```

    **Implementation:**
    - Use `useForm<FactoryFormData>` with `zodResolver(factoryFormSchema)` and defaultValues
    - Default timezone to `'UTC'` if no defaultValues provided
    - Form structure with `<form onSubmit={handleSubmit(onSubmit)} className="space-y-4">`
    - Three field groups, each with:
      - `<Label htmlFor="fieldName">` (accessible label)
      - `<Input id="fieldName" {...register('fieldName')} />` (uncontrolled via register -- NOT Controller)
      - Error message: `{errors.fieldName && <p className="text-sm text-destructive mt-1">{errors.fieldName.message}</p>}`
    - Fields:
      - `name` (required): Label "Factory Name", placeholder "Enter factory name"
      - `location` (optional): Label "Location", placeholder "Enter location"
      - `timezone` (required): Label "Timezone", placeholder "UTC" — plain text input (timezone picker deferred)
    - Submit button using `<Button>` with `disabled={isSubmitting}`, text from `submitLabel` prop (default: "Save")
    - Show "Saving..." text when isSubmitting is true

    **Key decisions:**
    - Use `register` (not Controller) for all fields per research recommendation (minimal re-renders)
    - Export both the component and the Zod schema (schema reusable for API validation in Phase 14)
    - Accept `isSubmitting` as prop (controlled by parent/mutation state) rather than internal form state
    - Use consistent error styling: `text-sm text-destructive mt-1`
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit` — zero errors.
    File exports `FactoryForm` component and `factoryFormSchema`.
    Component uses `useForm` with `zodResolver`.
    All three fields use `register()` pattern (not Controller).
    Error messages use `text-destructive` class.
  </verify>
  <done>
    FactoryForm component renders name, location, timezone fields with labels, Zod validation, and consistent error display. Accepts defaultValues for edit mode and onSubmit callback. Uses register pattern for minimal re-renders. Schema exported for reuse.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GatewayForm component with Zod validation</name>
  <files>frontend/src/components/forms/GatewayForm.tsx</files>
  <action>
    Create the GatewayForm component in `frontend/src/components/forms/`.

    **GatewayForm.tsx:**

    Imports: Same as FactoryForm, plus `Factory` type from `@/types/api` (for factory select options).

    **Zod schema (export as `gatewayFormSchema`):**
    ```typescript
    export const gatewayFormSchema = z.object({
      factory_id: z.string().min(1, 'Factory is required'),
      gateway_id: z.string().min(1, 'Gateway ID is required'),
      name: z.string().min(1, 'Gateway name is required').max(100, 'Name must be 100 characters or less'),
      url: z.string().url('Must be a valid URL'),
      email: z.string().email('Must be a valid email address'),
      password: z.string().min(1, 'Password is required'),
      model: z.string().max(100).optional().or(z.literal('')),
      firmware_version: z.string().max(50).optional().or(z.literal('')),
    })
    ```

    For edit mode, password is optional (only updates if filled):
    ```typescript
    export const gatewayEditSchema = gatewayFormSchema.extend({
      password: z.string().optional().or(z.literal('')),
    })
    ```

    Types:
    ```typescript
    export type GatewayFormData = z.infer<typeof gatewayFormSchema>
    export type GatewayEditData = z.infer<typeof gatewayEditSchema>
    ```

    **Component props interface:**
    ```typescript
    interface GatewayFormProps {
      factories: Pick<Factory, 'id' | 'name'>[]  // For factory select dropdown
      defaultValues?: Partial<GatewayFormData>
      onSubmit: (data: GatewayFormData | GatewayEditData) => Promise<void>
      isSubmitting?: boolean
      submitLabel?: string
      mode?: 'create' | 'edit'  // Determines which schema to use
    }
    ```

    **Implementation:**
    - Use `mode` prop to select schema: `mode === 'edit' ? gatewayEditSchema : gatewayFormSchema`
    - Use `useForm` with the selected schema and zodResolver
    - Form structure with `<form onSubmit={handleSubmit(onSubmit)} className="space-y-4">`
    - Fields (each with Label + Input + error pattern):
      - `factory_id` (required): Label "Factory", rendered as `<select>` element with `{...register('factory_id')}`. Style the select with same border/input classes as Input for consistency. Options: `<option value="">Select a factory...</option>` + map over `factories` prop.
      - `gateway_id` (required): Label "Gateway ID", placeholder "e.g., GW-001"
      - `name` (required): Label "Gateway Name", placeholder "Enter gateway name"
      - `url` (required): Label "Gateway URL", placeholder "ws://192.168.1.100:5000"
      - `email` (required): Label "Email", placeholder "admin@gateway.local"
      - `password` (required in create, optional in edit): Label "Password", type="password". In edit mode, placeholder "Leave blank to keep current password"
      - `model` (optional): Label "Model", placeholder "e.g., CTC-W100"
      - `firmware_version` (optional): Label "Firmware Version", placeholder "e.g., 2.1.0"
    - Submit button with isSubmitting state

    **Key decisions:**
    - Separate schemas for create vs edit mode (password required vs optional)
    - Factory select uses native `<select>` element (not a custom dropdown) — sufficient for v1.1, accessible by default
    - Style `<select>` with similar classes to Input: `flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm`
    - Password field uses `type="password"` for masking (GATEWAY-07 security awareness)
    - Factories passed as prop (parent fetches via React Query, form stays pure/presentational)
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit` — zero errors.
    File exports `GatewayForm`, `gatewayFormSchema`, `gatewayEditSchema`.
    Component uses `useForm` with `zodResolver`.
    Password field has `type="password"`.
    Factory select renders options from `factories` prop.
    Edit mode uses `gatewayEditSchema` (password optional).
  </verify>
  <done>
    GatewayForm component renders all 8 fields with labels, Zod validation, factory select dropdown, and password masking. Supports create and edit modes with separate schemas. Accepts factories list as prop. Uses register pattern for all fields. Schemas exported for reuse.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` — zero errors
2. `cd frontend && npm run build` — builds successfully
3. `ls frontend/src/components/forms/` shows FactoryForm.tsx and GatewayForm.tsx
4. Both forms use `useForm` with `zodResolver`
5. Both forms export Zod schemas alongside components
6. Error messages use consistent `text-sm text-destructive mt-1` pattern
7. GatewayForm password field uses `type="password"`
8. GatewayForm has separate create/edit schemas
</verification>

<success_criteria>
- FactoryForm renders 3 fields (name, location, timezone) with validation
- GatewayForm renders 8 fields with factory select and password masking
- Both forms accept defaultValues for edit mode and onSubmit callback
- Zod schemas enforce required fields with clear error messages
- Forms use register() pattern (not Controller) for minimal re-renders
- Build succeeds with zero TypeScript errors
- COMP-02 (reusable form components) satisfied
- COMP-03 (forms/ directory organization) satisfied
- COMP-04 (TypeScript prop types) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/13-component-architecture/13-03-SUMMARY.md`
</output>
