---
phase: 06-testing-and-documentation
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - docs/BEHAVIOR.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "X/Y/Z waveform encoding format is documented with actual data samples"
    - "Gateway timing characteristics are documented (command response times, notification delays)"
    - "Observed error messages and close codes are documented"
    - "README enables a new developer to set up and run the spike without help"
    - "README includes configuration reference, troubleshooting, and project structure"
  artifacts:
    - path: "docs/BEHAVIOR.md"
      provides: "Discovered gateway behavior documentation"
      contains: "Waveform Encoding"
      min_lines: 80
    - path: "README.md"
      provides: "User-facing setup, configuration, and usage documentation"
      contains: "Prerequisites"
      min_lines: 100
  key_links:
    - from: "docs/BEHAVIOR.md"
      to: "TEST-CHECKLIST.md"
      via: "Extracts actual data from test results"
      pattern: "Observed|Actual|Discovered"
    - from: "README.md"
      to: "docs/BEHAVIOR.md"
      via: "References behavior docs for detailed findings"
      pattern: "BEHAVIOR.md"
---

<objective>
Create gateway behavior documentation (DOC-01, DOC-02) and project README (DOC-03) from the test results captured in Plan 01.

Purpose: Transform raw test observations into structured documentation that preserves spike learnings for future milestones and enables others to run the spike.

Output: `docs/BEHAVIOR.md` documenting discovered gateway behavior, and `README.md` with setup/config/usage instructions.
</objective>

<execution_context>
@/Users/craigcronin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/craigcronin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-testing-and-documentation/06-RESEARCH.md
@.planning/phases/06-testing-and-documentation/06-01-SUMMARY.md
@.planning/phases/06-testing-and-documentation/TEST-CHECKLIST.md
@src/main.ts
@src/config.ts
@package.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/BEHAVIOR.md documenting discovered gateway behavior (DOC-01, DOC-02)</name>
  <files>docs/BEHAVIOR.md</files>
  <action>
Create `docs/BEHAVIOR.md` by extracting actual observations from the completed TEST-CHECKLIST.md. This documents GATEWAY behavior (what the hardware does), not application behavior (what our code does).

**Structure the document with these sections:**

**1. Header:**
- Title: "Gateway Behavior Documentation"
- Gateway Model: CTC Connect Wireless
- Firmware Version: (from test observations if discoverable)
- Documented: (date of test execution)
- Source: "Observed during Milestone 0 validation spike"

**2. Waveform Encoding Format (DOC-01):**
Extract from TEST-CHECKLIST.md Scenario 6 results:
- Encoding format detected (which parser strategy succeeded: CSV, JSON, or Base64)
- Data type (Int16LE, Float32, etc. if determinable)
- Units (milli-g, g, raw counts)
- Sample count per axis (actual observed)
- Byte order (if binary format)
- Raw data examples (first 200 chars of X, Y, Z strings from test)
- Parsing strategy that succeeded
- Value ranges observed (min/max per axis in g)
- Any anomalies or unexpected characteristics

**3. Timing Characteristics (DOC-02):**
Extract timing data from test results:
- Command Response Times table:
  | Command | Observed Response Time | Configured Timeout | Assessment |
  POST_LOGIN, GET_DYN_CONNECTED, POST_SUB_CHANGES, TAKE_DYN_READING
- Notification Arrival Times table:
  | Notification | After Event | Observed Delay | Notes |
  NOT_DYN_READING_STARTED (after TAKE_DYN_READING), NOT_DYN_READING (after STARTED), NOT_DYN_TEMP (after TAKE_DYN_READING)
- Total acquisition cycle time (trigger to data received)
- Timeout assessment: Are current settings appropriate?

**4. Error Messages and Close Codes (DOC-02):**
Extract from edge case testing (if performed):
- RTN_ERR responses observed:
  | Scenario | Error.Attempt | Error.Error | Behavior |
- WebSocket close codes observed:
  | Close Code | Scenario | Meaning |
- If no error testing was performed, note this as "Not tested - deferred to future milestone"

**5. Sensor Configuration (DOC-02):**
Extract from Scenario 4 results:
- Sensor metadata fields observed (Serial, PartNum, ReadRate, Samples, GMode, FreqMode, etc.)
- Any undocumented fields returned by gateway
- Sensor configuration values and what they mean

**6. Connection Behavior (DOC-02):**
- Connection establishment time
- Heartbeat behavior observed (if any)
- Any unexpected connection events

**7. Recommendations for Future Milestones:**
Based on all observations:
- Timeout adjustments needed?
- Parser changes needed?
- Any gateway quirks to account for?
- Data validation range adjustments?

Use the Pattern 2: Behavior Documentation Structure from 06-RESEARCH.md as the template. Document what was ACTUALLY OBSERVED, not what was expected. If something was not tested, say so explicitly rather than speculating.

IMPORTANT: Read TEST-CHECKLIST.md FIRST to extract actual data. Do NOT fabricate test results. If a section has no data from testing, write "Not observed during testing" rather than inventing values.
  </action>
  <verify>
File exists at `docs/BEHAVIOR.md`. Contains sections for Waveform Encoding Format, Timing Characteristics, Error Messages, Sensor Configuration. All data in the document traces back to TEST-CHECKLIST.md actual results. No fabricated data.
  </verify>
  <done>docs/BEHAVIOR.md exists with gateway behavior documentation derived from actual test results, covering DOC-01 (waveform encoding) and DOC-02 (gateway behavior including timeouts, errors, close codes).</done>
</task>

<task type="auto">
  <name>Task 2: Create README.md with setup, configuration, and usage instructions (DOC-03)</name>
  <files>README.md</files>
  <action>
Create `README.md` at the project root following the Pattern 3: README Structure from 06-RESEARCH.md.

**Sections:**

**1. Title and Description:**
- "Gateway Integration Spike"
- One paragraph: TypeScript/Node.js app that connects to CTC Connect gateway, discovers sensors, triggers vibration reading, displays waveform data. Validates communication layer before building full monitoring system.
- Status badge: validated with real hardware (include date from test)

**2. What This Is:**
- Brief explanation of Milestone 0 spike purpose
- What it validates (list the communication steps)
- What it does NOT do (not production, not multi-gateway, not persistent)

**3. Prerequisites:**
- Node.js 20+ (project uses --env-file flag which requires 20.6+, and native crypto.randomUUID)
- Access to CTC Connect Wireless gateway on local network
- Gateway with at least one connected vibration sensor
- Gateway credentials (email/password)

**4. Setup:**
- Clone and install: `npm install`
- Create `.env` file with example content showing all env vars
- Build: `npm run build`

**5. Usage:**
- Run: `npm run dev` (for tsx development mode)
- Or: `npm run build && npm start` (compiled)
- Expected output: show realistic example output matching what waveform-display.ts produces
- What happens: connect -> auth -> discover -> subscribe -> acquire -> display -> unsubscribe -> exit

**6. Configuration:**
Table of all environment variables from config.ts:
| Variable | Required | Default | Description |
GATEWAY_URL (required), GATEWAY_EMAIL (required), GATEWAY_PASSWORD (required), SENSOR_SERIAL (optional, number), LOG_LEVEL (optional, default "info"), HEARTBEAT_INTERVAL_MS (optional), COMMAND_TIMEOUT_MS (optional), ACQUISITION_TIMEOUT_MS (optional)

Read src/config.ts to get exact variable names and defaults.

**7. What Was Validated:**
Checklist of validated capabilities from test results. Reference docs/BEHAVIOR.md for details.

**8. Key Findings:**
Brief summary of most important discoveries:
- Waveform encoding format (from BEHAVIOR.md)
- Typical reading time
- Any surprising gateway behavior

**9. Project Structure:**
```
src/
  config.ts, main.ts
  types/ (connection.ts, messages.ts, index.ts)
  gateway/ (connection.ts, command-client.ts, message-router.ts, notification-handler.ts, authenticator.ts, sensor-discovery.ts, heartbeat.ts, reconnect.ts)
  acquisition/ (acquisition-manager.ts, waveform-parser.ts)
  output/ (waveform-display.ts)
  utils/ (logger.ts)
```

**10. Next Steps (Future Milestones):**
Brief list from PROJECT.md out of scope section - what comes next.

**11. Troubleshooting:**
Common issues and fixes:
- Connection fails (check IP, gateway power, port 5000)
- Auth fails (check credentials, account active)
- No sensors (check sensor power, wireless range, LED status)
- Reading timeout (sensor connectivity, increase timeout, battery state)
- Build errors (Node.js version, npm install)

**12. License:**
ISC (matches package.json)

IMPORTANT: Read config.ts to get exact env var names. Read package.json for exact scripts. Read docs/BEHAVIOR.md (created in Task 1) for key findings to reference. Do NOT use placeholder values where real project data is available.
  </action>
  <verify>
File exists at `README.md`. Contains all required sections: Prerequisites, Setup, Usage, Configuration table, Project Structure, Troubleshooting. Configuration table matches actual env vars from config.ts. npm commands match package.json scripts. References docs/BEHAVIOR.md for detailed findings.
  </verify>
  <done>README.md exists at project root with complete setup, configuration, usage, project structure, and troubleshooting documentation. A new developer could follow it to set up and run the spike.</done>
</task>

</tasks>

<verification>
- docs/BEHAVIOR.md exists and documents actual gateway behavior from test results
- docs/BEHAVIOR.md covers waveform encoding (DOC-01) and gateway behavior (DOC-02)
- README.md exists at project root
- README.md configuration table matches src/config.ts env vars
- README.md npm commands match package.json scripts
- README.md references docs/BEHAVIOR.md for detailed findings
- No fabricated test data in either document
</verification>

<success_criteria>
- DOC-01 satisfied: Waveform encoding format documented in BEHAVIOR.md with actual data samples
- DOC-02 satisfied: Gateway behavior documented in BEHAVIOR.md (timeouts, close codes, errors, timing)
- DOC-03 satisfied: README.md enables setup, configuration, and usage without external help
- All documentation traces to actual test observations, not speculation
</success_criteria>

<output>
After completion, create `.planning/phases/06-testing-and-documentation/06-02-SUMMARY.md`
</output>
