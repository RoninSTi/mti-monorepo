---
phase: 17-quality-and-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/eslint.config.js
  - frontend/src/components/forms/FactoryForm.tsx
  - frontend/src/components/forms/GatewayForm.tsx
  - frontend/src/pages/FactoriesPage.tsx
  - frontend/src/pages/GatewaysPage.tsx
autonomous: true

must_haves:
  truths:
    - "TypeScript strict mode is enabled and `npm run type-check` passes with zero errors"
    - "`npm run lint` passes with zero errors"
    - "FactoriesPage and GatewaysPage follow identical patterns for loading, error, empty states, CRUD handlers, and toast notifications"
    - "All form fields display specific, human-readable validation error messages"
  artifacts:
    - path: "frontend/package.json"
      provides: "type-check script for standalone TypeScript verification"
      contains: "type-check"
    - path: "frontend/eslint.config.js"
      provides: "Clean ESLint configuration that passes on all source files"
  key_links:
    - from: "frontend/package.json"
      to: "tsc"
      via: "type-check script"
      pattern: "tsc.*noEmit"
---

<objective>
Verify and enforce TypeScript strict mode, fix ESLint errors, and audit component pattern consistency across all pages and forms.

Purpose: Satisfy QUAL-UI-01 (TypeScript strict), QUAL-UI-02 (consistent patterns), and QUAL-UI-03 (form validation messages). The codebase already has strict mode enabled and forms have validation -- this plan verifies zero errors and fixes the 5 existing ESLint violations.
Output: Clean `npm run type-check` and `npm run lint` with zero errors, verified consistent patterns.
</objective>

<execution_context>
@/Users/craigcronin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/craigcronin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-quality-&-polish/17-RESEARCH.md
@frontend/package.json
@frontend/tsconfig.app.json
@frontend/eslint.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add type-check script and fix ESLint errors</name>
  <files>frontend/package.json, frontend/eslint.config.js</files>
  <action>
1. Add a `type-check` script to `frontend/package.json` scripts:
   ```
   "type-check": "tsc -b --noEmit"
   ```
   This allows standalone TypeScript checking without building.

2. Fix the 5 ESLint `react-refresh/only-export-components` errors. These come from exporting Zod schemas and `badgeVariants`/`buttonVariants` alongside components. The standard fix is to add `allowConstantExport: true` to the react-refresh plugin configuration in `eslint.config.js`. Update the config to:
   ```js
   reactRefresh.configs.vite,
   ```
   Replace with explicit configuration that includes allowConstantExport:
   ```js
   {
     plugins: { 'react-refresh': reactRefresh },
     rules: {
       'react-refresh/only-export-components': ['warn', { allowConstantExport: true }],
     },
   },
   ```
   Note: Since `reactRefresh.configs.vite` is a flat config preset, you need to replace it with the manual plugin+rules setup, OR keep it and override the rule. The simpler approach: keep `reactRefresh.configs.vite` in extends but add a rules override after it:

   Actually, the cleanest approach: Remove `reactRefresh.configs.vite` from extends and add the plugin + rule manually in the same config block. This avoids config ordering issues.

3. Run `npm run type-check` and verify zero errors.
4. Run `npm run lint` and verify zero errors.
5. Run `npm run build` and verify clean production build.
  </action>
  <verify>
    Run from frontend directory:
    - `npm run type-check` exits 0 with no output
    - `npm run lint` exits 0 with no errors
    - `npm run build` completes successfully
  </verify>
  <done>
    - package.json has "type-check" script
    - ESLint passes with zero errors on all source files
    - TypeScript strict mode verified with zero errors
    - Production build succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit and verify component pattern consistency</name>
  <files>frontend/src/pages/FactoriesPage.tsx, frontend/src/pages/GatewaysPage.tsx, frontend/src/components/forms/FactoryForm.tsx, frontend/src/components/forms/GatewayForm.tsx</files>
  <action>
Audit all pages and forms for pattern consistency. Compare FactoriesPage.tsx and GatewaysPage.tsx side by side. Verify these patterns are identical:

**Page components (FactoriesPage, GatewaysPage):**
1. UI state section: useState hooks for create dialog, editing item, deleting item
2. Data fetching: useEntities() hook with destructured { data, isLoading, isError, error }
3. Mutations: useCreate/useUpdate/useDelete hooks
4. Handler pattern: async function with try/catch, mutateAsync, toast.success/toast.error, dialog close
5. Loading state: Loader2 spinner with centered layout and text description
6. Error state: Card with destructive border, error message, Try Again button
7. Safety check: `if (!data) return null`
8. Main layout: `<div className="space-y-6">` with page header, data table, dialogs
9. Empty state: TableRow with colSpan, centered content, description text, CTA button
10. Dialog pattern: Dialog/AlertDialog with proper open/onOpenChange wiring

**Forms (FactoryForm, GatewayForm):**
1. Zod schema exported from form file
2. FormData type exported via z.infer
3. Props interface: defaultValues, onSubmit, isSubmitting, submitLabel
4. useForm with zodResolver
5. Error display: `{errors.field && <p className="text-sm text-destructive mt-1">{errors.field.message}</p>}` on every field
6. Submit button: disabled when isSubmitting, shows "Saving..." text

Check that both the FactoriesPage error state and GatewaysPage error state use the same structure. Currently they are slightly different:
- FactoriesPage uses CardDescription for the error message
- GatewaysPage uses a `<p>` tag with margin
Make them consistent -- use the FactoriesPage pattern (CardDescription) in GatewaysPage.

Also verify that every form field has an error message display. Count fields vs error displays:
- FactoryForm: 3 fields (name, location, timezone) -- verify 3 error displays
- GatewayForm: 8 fields (factory_id, gateway_id, name, url, email, password, model, firmware_version) -- verify 8 error displays

If any inconsistencies are found, fix them to match the established pattern. Document all findings.
  </action>
  <verify>
    - Diff FactoriesPage and GatewaysPage patterns: loading, error, empty state structures are structurally identical
    - Every form field has a corresponding error message display
    - `npm run build` still passes after any changes
  </verify>
  <done>
    - Both page components follow identical structural patterns (loading, error, empty, CRUD handlers, dialog wiring)
    - GatewaysPage error state matches FactoriesPage error state structure (uses CardDescription)
    - All 3 FactoryForm fields and all 8 GatewayForm fields have error message displays
    - QUAL-UI-02 (consistent patterns) and QUAL-UI-03 (form validation messages) verified
  </done>
</task>

</tasks>

<verification>
From the frontend directory:
1. `npm run type-check` -- zero errors
2. `npm run lint` -- zero errors
3. `npm run build` -- clean production build
4. Manual review: FactoriesPage and GatewaysPage follow identical patterns
5. Manual review: Every form field has visible error message on validation failure
</verification>

<success_criteria>
- QUAL-UI-01: TypeScript strict mode enabled with zero errors (verified via `npm run type-check`)
- QUAL-UI-02: Component patterns consistent across FactoriesPage and GatewaysPage
- QUAL-UI-03: All form fields display clear, specific validation error messages
- Zero ESLint errors across the codebase
</success_criteria>

<output>
After completion, create `.planning/phases/17-quality-&-polish/17-01-SUMMARY.md`
</output>
